<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Pomodoro í†µê³„</title>
  <!-- âœ… ì™¸ë¶€ CSS ì ìš© -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #fdfdfd;
      padding: 10px; /* ì „ì²´ í˜ì´ì§€ íŒ¨ë”©ì„ ì¤„ì„ */
      margin: 0; /* body ê¸°ë³¸ ë§ˆì§„ ì œê±° */
    }

    h1 {
      margin-bottom: 20px; /* ì œëª© í•˜ë‹¨ ë§ˆì§„ ì¤„ì„ */
      color: #333;
      font-size: 2.2em; /* ì œëª© í¬ê¸° ì¡°ì • */
    }

    .chart-container {
      width: 95%; /* ë„ˆë¹„ë¥¼ ì¡°ê¸ˆ ëŠ˜ë¦¼ */
      max-width: 700px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
      margin-bottom: 20px; /* ì»¨í…Œì´ë„ˆ í•˜ë‹¨ ë§ˆì§„ ì¤„ì„ */
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì ì•½í•˜ê²Œ */
      padding: 15px 20px; /* ë‚´ë¶€ íŒ¨ë”© ì¤„ì„ */
      
      height: auto; /* ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì ˆ */
      min-height: 150px; /* ìµœì†Œ ë†’ì´ ì„¤ì • (ë‚´ìš©ì— ë”°ë¼ ëŠ˜ì–´ë‚¨) */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-sizing: border-box; /* íŒ¨ë”©ì´ ë„ˆë¹„/ë†’ì´ì— í¬í•¨ë˜ë„ë¡ */
    }
    
    canvas {
        width: 100% !important;
        height: 300px !important; /* ê·¸ë˜í”„ ìº”ë²„ìŠ¤ì˜ ê³ ì • ë†’ì´ */
        max-height: 300px; /* ìµœëŒ€ ë†’ì´ ì„¤ì • */
    }


    .chart-container h2 {
      margin-top: 10px; /* ì œëª© ìƒë‹¨ ë§ˆì§„ ì¤„ì„ */
      margin-bottom: 15px; /* ì œëª© í•˜ë‹¨ ë§ˆì§„ ì¤„ì„ */
      color: #555;
      text-align: center;
      font-size: 1.5em; /* ë¶€ì œëª© í¬ê¸° ì¡°ì • */
    }

    table {
      width: 100%;
      text-align: center;
      border-collapse: collapse;
      margin-top: 10px; /* í…Œì´ë¸” ìƒë‹¨ ë§ˆì§„ ì¤„ì„ */
      font-size: 0.9em; /* í…Œì´ë¸” í…ìŠ¤íŠ¸ í¬ê¸° ì¤„ì„ */
    }

    th, td {
      border: 1px solid #e9e9e9; /* í…Œë‘ë¦¬ ë” ì—°í•˜ê²Œ */
      padding: 8px; /* í…Œì´ë¸” ì…€ íŒ¨ë”© ì¤„ì„ */
    }

    th {
      background-color: #f9f9f9;
      font-weight: bold;
      color: #333;
    }

    td {
      background-color: #ffffff;
    }

    /* "ë°ì´í„° ì—†ìŒ" ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .no-data-message {
        color: #888;
        font-style: italic;
        text-align: center;
        padding: 15px 0; /* íŒ¨ë”© ì¤„ì„ */
        font-size: 0.9em;
    }

    /* ì‚¬ìš©ì ì§‘ì¤‘ ìœ í˜• í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
    .chart-container p {
        font-size: 0.95em;
        margin: 5px 0; /* ë§ˆì§„ ì¤„ì„ */
    }
    .chart-container p strong {
        font-size: 1.3em; /* ìœ í˜• ì´ë¦„ í¬ê¸° ì¡°ì • */
    }

    /* ì²˜ìŒìœ¼ë¡œ ë²„íŠ¼ ë˜í¼ ë§ˆì§„ ì¤„ì„ */
    .start-button-wrapper {
        margin-top: 20px; /* ë§ˆì§„ ì¤„ì„ */
        margin-bottom: 20px; /* ë§ˆì§„ ì¤„ì„ */
    }
  </style>
</head>
<body>
  <h1>Pomodoro ì§‘ì¤‘ í†µê³„</h1>

  <!-- ğŸŒŸ ë‹¹ì‹ ì˜ ì§‘ì¤‘ ìœ í˜• -->
  <div class="chart-container">
    <h2>ğŸŒŸ ë‹¹ì‹ ì˜ ì§‘ì¤‘ ìœ í˜•</h2>
    {% if user_type == "ë°ì´í„° ë¶€ì¡±" %}
      <p class="no-data-message">
        ì•„ì§ ë‹¹ì‹ ì˜ ê³ ìœ í•œ ì§‘ì¤‘ íŒ¨í„´ì„ ë¶„ì„í•˜ê¸°ì—” ë°ì´í„°ê°€ ë¶€ì¡±í•´ìš”. <br>
        í¬ëª¨ë„ë¡œ ì„¸ì…˜ì„ ê¾¸ì¤€íˆ ê¸°ë¡í•˜ë©° ë‹¹ì‹ ë§Œì˜ í•™ìŠµ/ì‘ì—… ìŠ¤íƒ€ì¼ì„ ì°¾ì•„ë³´ì„¸ìš”! ğŸš€
      </p>
    {% else %}
      <p style="font-size: 1.5rem;"><strong>{{ user_type }}</strong></p>
      <p>{{ user_desc }}</p>
    {% endif %}
  </div>

  <!-- ğŸ“† í•˜ë£¨ ìš”ì•½ -->
  <div class="chart-container">
    <h2>ğŸ“† ë‹¬ë ¥ ê¸°ë°˜ í•˜ë£¨ ìš”ì•½</h2>
    <table>
      <thead>
        <tr>
          <th>ë‚ ì§œ</th>
          <th>ëª©í‘œ ë‹¬ì„±ë¥ </th>
          <th>í‰ê·  ì§‘ì¤‘ë„</th>
        </tr>
      </thead>
      <tbody id="calendarTableBody"></tbody>
    </table>
  </div>

  <div class="chart-container">
    <h2>ğŸŒ¿ ì„±ì¥ ê³¡ì„  (ì¼ë³„ ì§‘ì¤‘ë ¥ + ëª©í‘œ ë‹¬ì„±ë¥ )</h2>
    <canvas id="growthChartSimple"></canvas>
  </div>

  <!-- âœ… ì²˜ìŒìœ¼ë¡œ ë²„íŠ¼ -->
  <div class="start-button-wrapper">
    <form action="/">
      <button type="submit" class="start-button">ì²˜ìŒìœ¼ë¡œ</button>
    </form>
  </div>

  <script>
    // ì¼ë³„ ìš”ì•½ í…Œì´ë¸”ì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸
    const dailySummary = JSON.parse('{{ daily_summary_data | tojson | safe }}');
    const tableBody = document.getElementById('calendarTableBody');

    if (Object.keys(dailySummary).length === 0) {
      tableBody.innerHTML = '<tr><td colspan="3" class="no-data-message">' +
        "ì•„ì§ ì„¸ì…˜ ê¸°ë¡ì´ ì—†ë„¤ìš”. 'ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ë½€ëª¨ë„ë¡œ ì„¸ì…˜ì„ ì‹œì‘í•˜ê³  ê¸°ë¡í•´ë³´ì„¸ìš”! âœï¸" +
        '</td></tr>';
    } else {
      Object.entries(dailySummary).forEach(([date, data]) => {
        const tr = document.createElement('tr');
        const goalIcon = data.goal_rate >= 50 ? "âœ…" : "âŒ"; // 50% ì´ìƒì´ë©´ ë‹¬ì„±ìœ¼ë¡œ í‘œì‹œ

        let focusColor = "transparent"; // ê¸°ë³¸ ë°°ê²½ìƒ‰
        if (data.avg_focus_score >= 4.5) focusColor = "#d4edda"; // Greenish
        else if (data.avg_focus_score >= 3.5) focusColor = "#fff3cd"; // Yellowish
        else if (data.avg_focus_score >= 2.5) focusColor = "#ffeeba"; // Orangeish
        else if (data.avg_focus_score > 0) focusColor = "#f8d7da"; // Reddish (ë°ì´í„°ê°€ 0ì´ ì•„ë‹ ë•Œë§Œ ìƒ‰ìƒ ì ìš©)
        
        tr.innerHTML = `
          <td>${date}</td>
          <td>${goalIcon} (${Math.round(data.goal_rate)}%)</td>
          <td style="background-color:${focusColor}">${data.avg_focus_score.toFixed(2)}</td>
        `;
        tableBody.appendChild(tr);
      });
    }
  </script>

  <script>
    // ì„±ì¥ ê³¡ì„  (ì¼ë³„)
    const dailyGrowthData = JSON.parse('{{ daily_summary_data | tojson | safe }}');
    const dateLabels = Object.keys(dailyGrowthData).sort();

    const focusValuesDaily = dateLabels.map(d => dailyGrowthData[d].avg_focus_score);
    const goalValuesDaily = dateLabels.map(d => dailyGrowthData[d].goal_rate);

    const ctxGrowth = document.getElementById('growthChartSimple').getContext('2d');
    
    if (dateLabels.length === 0) {
        const chartContainer = document.getElementById('growthChartSimple').closest('.chart-container');
        if (chartContainer) {
            chartContainer.innerHTML = '<p class="no-data-message">' +
                "ì„¸ì…˜ ê¸°ë¡ì´ ìŒ“ì´ë©´ ë‹¹ì‹ ì˜ ì§‘ì¤‘ë ¥ê³¼ ëª©í‘œ ë‹¬ì„±ë¥  ë³€í™”ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆì–´ìš”! <br>" +
                "ê¾¸ì¤€íˆ ê¸°ë¡í•˜ë©° ì„±ì¥ ê³¡ì„ ì„ ê·¸ë ¤ë‚˜ê°€ì„¸ìš”! ğŸŒ±" +
                '</p>';
        }
    } else {
        new Chart(ctxGrowth, {
            type: 'line',
            data: {
                labels: dateLabels,
                datasets: [
                    {
                        label: 'ğŸ“ˆ í‰ê·  ì§‘ì¤‘ë„ (1~5)',
                        data: focusValuesDaily,
                        borderColor: 'green',
                        backgroundColor: 'rgba(0,128,0,0.1)',
                        yAxisID: 'y1',
                        fill: false,
                        tension: 0.3
                    },
                    {
                        label: 'ğŸ¯ ëª©í‘œ ë‹¬ì„±ë¥  (%)',
                        data: goalValuesDaily,
                        borderColor: 'orange',
                        backgroundColor: 'rgba(255,165,0,0.1)',
                        yAxisID: 'y2',
                        fill: false,
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                stacked: false,
                scales: {
                    y1: {
                        type: 'linear',
                        position: 'left',
                        min: 0,
                        max: 5,
                        title: { display: true, text: 'í‰ê·  ì§‘ì¤‘ë„' }
                    },
                    y2: {
                        type: 'linear',
                        position: 'right',
                        min: 0,
                        max: 100,
                        title: { display: true, text: 'ëª©í‘œ ë‹¬ì„±ë¥  (%)' },
                        grid: { drawOnChartArea: false }
                    }
                },
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                }
            }
        });
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Pomodoro í†µê³„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        .chart-container { width: 80%; margin-bottom: 40px; }
    </style>
</head>
<body>
    <h1>Pomodoro ì§‘ì¤‘ í†µê³„</h1>

    <div class="chart-container">
    <h2>ğŸ“† ë‹¬ë ¥ ê¸°ë°˜ í•˜ë£¨ ìš”ì•½</h2>
    <table border="1" style="width:100%; text-align: center;">
        <thead>
            <tr>
                <th>ë‚ ì§œ</th>
                <th>ëª©í‘œ ë‹¬ì„±</th>
                <th>ì§‘ì¤‘ë„</th>
            </tr>
        </thead>
        <tbody id="calendarTableBody"></tbody>
    </table>
    </div>  

    
    <script>
    const dailySummary = JSON.parse('{{ daily_summary_data | tojson | safe }}');

    const tableBody = document.getElementById('calendarTableBody');
    Object.entries(dailySummary).forEach(([date, data]) => {
        const tr = document.createElement('tr');

        // ëª©í‘œ ë‹¬ì„±ë¥  50% ì´ìƒì´ë©´ âœ… ì•„ë‹ˆë©´ âŒ
        const goalIcon = data.goal_achievement_rate >= 50 ? "âœ…" : "âŒ";

        // ì§‘ì¤‘ë„ í‰ê· ì— ë”°ë¼ ìƒ‰ìƒ
        let focusColor = "gray";
        if (data.avg_focus_score >= 4.5) focusColor = "green";
        else if (data.avg_focus_score >= 3.5) focusColor = "lightgreen";
        else if (data.avg_focus_score >= 2.5) focusColor = "orange";
        else focusColor = "red";

        tr.innerHTML = `
            <td>${date}</td>
            <td>${goalIcon} (${Math.round(data.goal_achievement_rate)}%)</td>
            <td style="background-color:${focusColor}">${data.avg_focus_score.toFixed(2)}</td>
        `;
        tableBody.appendChild(tr);
    });
    </script>

    <div class="chart-container">
        <h2>ğŸŒ¿ ì„±ì¥ ê³¡ì„  (ì£¼ê°„ ì§‘ì¤‘ë ¥ + ëª©í‘œ ë‹¬ì„±ë¥ )</h2>
        <canvas id="growthChartSimple"></canvas>
    </div>

    <script>
        const weeklyGrowth = JSON.parse('{{ weekly_growth_data | tojson | safe }}');
        const weekLabels = Object.keys(weeklyGrowth).sort();
        const focusValues = weekLabels.map(w => weeklyGrowth[w].avg_focus);
        const goalValues = weekLabels.map(w => weeklyGrowth[w].goal_rate);

        const ctxGrowth = document.getElementById('growthChartSimple').getContext('2d');
        new Chart(ctxGrowth, {
            type: 'line',
            data: {
                labels: weekLabels,
                datasets: [
                    {
                        label: 'ğŸ“ˆ í‰ê·  ì§‘ì¤‘ë„ (1~5)',
                        data: focusValues,
                        borderColor: 'green',
                        backgroundColor: 'rgba(0,128,0,0.1)',
                        yAxisID: 'y1',
                        fill: false,
                        tension: 0.3
                    },
                    {
                        label: 'ğŸ¯ ëª©í‘œ ë‹¬ì„±ë¥  (%)',
                        data: goalValues,
                        borderColor: 'orange',
                        backgroundColor: 'rgba(255,165,0,0.1)',
                        yAxisID: 'y2',
                        fill: false,
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                stacked: false,
                scales: {
                    y1: {
                        type: 'linear',
                        position: 'left',
                        min: 0,
                        max: 5,
                        title: { display: true, text: 'í‰ê·  ì§‘ì¤‘ë„' }
                    },
                    y2: {
                        type: 'linear',
                        position: 'right',
                        min: 0,
                        max: 100,
                        title: { display: true, text: 'ëª©í‘œ ë‹¬ì„±ë¥  (%)' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });
    </script>


    <div class="chart-container">
        <h2>ğŸŒŸ ë‹¹ì‹ ì˜ ì§‘ì¤‘ ìœ í˜•</h2>
        <p style="font-size: 1.5rem;"><strong>{{ user_type }}</strong></p>
        <p>{{ user_desc }}</p>
    </div>
</body>
</html>
